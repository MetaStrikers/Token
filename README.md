## 準備

- Node.js v16.13.0 をインストールしてください
  - そこまで厳密でなくてもよいです
  - `nodenv`もしくは`asdf`を用いると厳密に同じバーションで実行できます
- yarn をインストールしてください（更新方法後述）

```shell
// nodeのバージョン確認方法
node -v

// yarnのインストール方法
npm install -g yarn
```

## 依存パッケージのインストール

```
yarn install --immutable
```

## compile

```shell
yarn compile
```

solidity ファイルのコンパイル・コントラクトの型定義ファイル（`typeChain`による）の生成を行うコマンドです。

## clean

```shell
yarn clean
```

compile 生成物を消去するコマンドです。
大きな merge の後、動作がおかしくなった場合に実行すると解消することが多いです。

## test

```shell
yarn test
```

- このディレクトリで`hardhat-gas-reporter` をインストールしていると関数ごとの gas 使用量が確認できます。

```
·-----------------------|---------------------------|--------------|-----------------------------·
|  Solc version: 0.8.8  ·  Optimizer enabled: true  ·  Runs: 2000  ·  Block limit: 30000000 gas  │
························|···························|··············|······························
|  Methods                                                                                       │
·············|··········|·············|·············|··············|·············|················
|  Contract  ·  Method  ·  Min        ·  Max        ·  Avg         ·  # calls    ·  usd (avg)    │
·------------|----------|-------------|-------------|--------------|-------------|---------------·

```

テストを実行するコマンドです

## run virtual node

```shell
yarn hardhat node
```

ローカルに仮想ノードを実行するコマンドです

## flatten contract

```
yarn flatten
```

solidity ファイルを平滑化するコマンドです。

標準出力に出力されるので以下のようにしてファイルに保存できますが、デプロイ時にのみ必要なファイルのためリポジトリ管理ファイルには含めないでください。

```
yarn flatten > flatten.sol
```

## file watcher

```
yarn dev
```

テストファイルを監視して保存の度にテストを実行するコマンドです。

## package update

```
yarn update
```

`package.json`に記載のパッケージ郡の更新を確認し`package.json`ファイル自身を更新するコマンドです

※ 開発者同士での合意形成を経ての利用を想定しています（頻繁に打つものではないです）。

## fmt

fmt はフォーマットの略称です。

`.prettierrc.js` の設定を元にソースコードのフォーマットを確認します。

```sh
# 現在のコードのフォーマットが正しいかを確認
yarn fmt
# 現在のコードのフォーマットを正しい形に自動修正
yarn fmt --write
```

## coverage

solidity-coverage plugin を用いて、テストカバレッジを計測します。

事前準備

- このディレクトリで`npm install`して`solidity-coverage` をインストールしていること

コマンドは

```sh
yarn coverage
```

結果。各コントラクトのカバレッジ率が見える

```
-----------------------|----------|----------|----------|----------|----------------|
File                   |  % Stmts | % Branch |  % Funcs |  % Lines |Uncovered Lines |
-----------------------|----------|----------|----------|----------|----------------|
 contracts/            |        0 |        0 |        0 |        0 |                |
                       |        0 |        0 |        0 |        0 |                |
-----------------------|----------|----------|----------|----------|----------------|
All files              |        0 |        0 |        0 |        0 |                |
-----------------------|----------|----------|----------|----------|----------------|
```

## .env

以下のコマンドを実行し、`.env`に必要情報を都度書き込んでください。

```shell
cp .env.sample .env
```

デプロイするために EOA の秘密鍵を `.env`ファイルに記載する必要があります。

```
PRIVATE_KEY=0xaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
```
